<div class="add-company-main">
  <form [formGroup]="addCompanyFormData" (ngSubmit)="onSubmit()">
    <div class="card my-2 card-shadow p-0">
      <div class="card-header font-weight-bold">{{editingCompanyData === true ? 'Update' : 'Add New'}} Company</div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-4">
            <div class="form-row">
              <div class="form-group col-md-12">
                <label for="">Name<span class="text-danger">*</span></label>
                <input onblur="this.value=jQuery.trim(this.value)" type="text" formControlName="name" class="form-control" placeholder="Name"
                  [ngClass]="{ 'is-invalid': submitted && f.name.errors }" />
                <div *ngIf="submitted && f.name.errors" class="invalid-feedback">
                  <div *ngIf="f.name.errors.required">Company Name is required.</div>
                  <div *ngIf="f.name.errors.pattern">Company Name is invalid.</div>
                </div>
              </div>
              <div class="form-group col-md-12">
                <label for="">Code<span class="text-danger">*</span></label>
                <input onblur="this.value=jQuery.trim(this.value)" type="text" oninput="this.value = this.value.toLowerCase()" formControlName="code"
                  class="form-control" placeholder="Code" [ngClass]="{ 'is-invalid': submitted && f.code.errors }" />

                <div *ngIf="submitted && f.code.errors" class="invalid-feedback">
                  <div *ngIf="f.code.errors.required">Code is required</div>
                  <div *ngIf="f.code.errors.pattern">Code is invalid</div>
                  <div *ngIf="f.code.errors.uniqueCode">Code must be unique </div>
                
                </div>
              </div>

              <div class="form-group col-md-12">
                <label for="">GSTIN</label>
                <input onblur="this.value=jQuery.trim(this.value)" type="text" formControlName="GSTIN" class="form-control" placeholder="GSTIN"
                  [ngClass]="{ 'is-invalid': submitted && f.GSTIN.errors }" />
                <div *ngIf="submitted && f.GSTIN.errors" class="invalid-feedback">
                  <div *ngIf="f.GSTIN.errors.required">GSTIN is required.</div>
                  <div *ngIf="f.GSTIN.errors.pattern">GSTIN is invalid.</div>
                </div>
              </div>
              <div class="form-group col-md-12">
                <label for="">PAN</label>
                <input onblur="this.value=jQuery.trim(this.value)" type="text" formControlName="panNo" class="form-control" placeholder="PAN"
                  [ngClass]="{ 'is-invalid': submitted && f.panNo.errors }" />
                <div *ngIf="submitted && f.panNo.errors" class="invalid-feedback">
                  <div *ngIf="f.panNo.errors.required">Pan no is required.</div>
                  <div *ngIf="f.panNo.errors.pattern">Pan no is invalid.</div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4 border-left">
            <div class="form-row">
              <div class="form-group col-md-12">
                <label for="">Address</label>
                <input onblur="this.value=jQuery.trim(this.value)" type="text" formControlName="address" class="form-control" placeholder="Address"
                  [ngClass]="{ 'is-invalid': submitted && f.address.errors }" />
                <div *ngIf="submitted && f.address.errors" class="invalid-feedback">
                  <div *ngIf="f.address.errors.required">Company address is required.</div>
                  <div *ngIf="f.address.errors.pattern">Company address is invalid.</div>
                </div>
              </div>
              <div class="city-state-country container-fluid">
                <div class="row">
                  <div class="form-group col">
                    <label for="">Country</label>
                    <select type="text" formControlName="countryId" class="form-control"
                      (change)="populateStateDropdown($event.target.value)" 
                       [ngClass]="{ 'is-invalid': submitted && f.countryId.errors }">
                      <option [value]="country._id" *ngFor="let country of countryStateCityArray">{{country.name}}
                      </option>
                    </select>
                    <div *ngIf="submitted && f.countryId.errors" class="invalid-feedback">
                        <div *ngIf="f.countryId.errors.required">Country is required</div>
                        <div *ngIf="f.countryId.errors.pattern">Country is invalid</div>
                      </div>
                  </div>
                  <div class="form-group col">
                    <label for="">State</label>
                    <select type="text" formControlName="stateId" class="form-control"
                      (change)="populateCityDropdown($event.target.value)">
                      <option [value]="state._id" *ngFor="let state of stateArray">{{state.name}}</option>
                    </select>
                  </div>
                  <div class="form-group col">
                    <label for="">City</label>
                    <select type="text" formControlName="cityId" class="form-control"
                      [ngClass]="{ 'is-invalid': submitted && f.cityId.errors }">
                      <option [value]="city._id" *ngFor="let city of cityArray">{{city.name}}</option>
                    </select>
                    <div *ngIf="submitted && f.cityId.errors" class="invalid-feedback">
                      <div *ngIf="f.cityId.errors.required">City is required</div>
                      <div *ngIf="f.cityId.errors.pattern">City is invalid</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-group col-md-12">
                <label for="">Landmark</label>
                <input onblur="this.value=jQuery.trim(this.value)" type="text" formControlName="landmark" class="form-control" placeholder="Landmark"
                  [ngClass]="{ 'is-invalid': submitted && f.landmark.errors }" />
                <div *ngIf="submitted && f.landmark.errors" class="invalid-feedback">
                  <div *ngIf="f.landmark.errors.required">Landmark is required</div>
                  <div *ngIf="f.landmark.errors.pattern">Landmark is invalid</div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4 border-left">
            <div class="form-row">
              <div class="form-group col-md-12">
                <label for="">Mobile</label>
                <input onblur="this.value=jQuery.trim(this.value)" type="text" formControlName="mobile" class="form-control" placeholder="Mobile"
                  [ngClass]="{ 'is-invalid': submitted && f.mobile.errors }" />
                <div *ngIf="submitted && f.mobile.errors" class="invalid-feedback">
                  <div *ngIf="f.mobile.errors.required">Mobile is required</div>
                  <div *ngIf="f.mobile.errors.pattern">Mobile is invalid</div>
                </div>
              </div>
              <div class="form-group col-md-12">
                <label for="">Land line</label>
                <input onblur="this.value=jQuery.trim(this.value)" type="text" formControlName="landline" class="form-control" placeholder="Land line"
                  [ngClass]="{ 'is-invalid': submitted && f.landline.errors }" />
                <div *ngIf="submitted && f.landline.errors" class="invalid-feedback">
                  <div *ngIf="f.landline.errors.required">Land line is required</div>
                  <div *ngIf="f.landline.errors.pattern">Land line is invalid</div>
                </div>
              </div>
              <div class="form-group col-md-12">
                <label for="">Email</label>
                <input onblur="this.value=jQuery.trim(this.value)" type="text" formControlName="email" class="form-control" placeholder="Email"
                  [ngClass]="{ 'is-invalid': submitted && f.email.errors }" />
                <div *ngIf="submitted && f.email.errors" class="invalid-feedback">
                  <div *ngIf="f.email.errors.required">Email is required</div>
                  <div *ngIf="f.email.errors.pattern">Email is invalid</div>
                </div>
              </div>
              <div class="form-group col-md-12">
                <label for="">Status</label>
                <div class="form-row">
                  <div class="col">
                    <label class="switch">
                      <input type="checkbox" formControlName="isActive">
                      <span class="slider round"></span>
                    </label>
                    <span class="pl-3" style="vertical-align: text-bottom;">
                      {{f.isActive.value === true ? 'Active' : 'Inactive'}}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <button class="btn btn-success mr-2">{{editingCompanyData === true ? 'Update' : 'Save'}}</button>
        <button class="btn btn-secondary mr-2" type="button" (click)="onReset()">Reset</button>
      </div>
    </div>
  </form>
  <div class="row">
    <div class="col-md-12">
      <div class="card my-4 card-shadow p-0">
        <div class="card-header font-weight-bold">View Company Details</div>
        <div class="card-body">
           <div class="table-responsive">
            <table id="dataTable" class="table table-striped table-bordered table-responsive">
              <thead>
                <tr>
                  <th>Company Name</th>
                  <th>Company Code</th>
                  <th>GSTIN</th>
                  <th>PAN</th>
                  <th>Address</th>
                  <th>Country</th>
                  <th>State</th>
                  <th>City</th>
                  <th>LandMark</th>
                  <th>Mobile</th>
                  <th>Email Id</th>
                  <th>Land Line</th>
                  <th>Visibility</th>
                  <th class="text-center" style="width: 100px;">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let companyData of companyTableData">
                  <td>{{companyData.name}}</td>
                  <td>{{companyData.code}}</td>
                  <td>{{companyData.GSTIN}}</td>
                  <td>{{companyData.panNo}}</td>
                  <td>{{companyData.address}}</td>
                  <td>{{companyData.countryName}}</td>
                  <td>{{companyData.stateName}}</td>
                  <td>{{companyData.cityName}}</td>
                  <td>{{companyData.landmark}}</td>
                  <td>{{companyData.mobile}}</td>
                  <td>{{companyData.email}}</td>
                  <td>{{companyData.landline}}</td>
                  <td>
                    <label class="switch" data-toggle="modal" (click)="activeCompany = companyData"
                      data-target="#changeCompanyStatus">
                      <input type="checkbox" [checked]="companyData.isActive" disabled>
                      <span class="slider round"></span>
                    </label>
                  </td>
                  <!--                <td>{{companyData.isActive ? 'Active' : 'Inactive'}}</td>-->
                  <td class="align-items-center d-flex justify-content-around actions">
                    <span (click)="editCompanyData(companyData)">Edit</span>
                    <i class="fa fa-trash text-danger" (click)="activeCompany = companyData" data-toggle="modal"
                      data-target="#deleteCompanyModal"></i>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 

<!-- Modal  deleteCompanyModal  -->
<div class="modal fade" id="deleteCompanyModal" tabindex="-1" role="dialog" aria-labelledby="companyModelLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="companyModelLabel">Delete Company</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">Are you sure you want to delete <b>
          {{activeCompany === undefined ? '' : activeCompany.name}} </b> ?</div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="deleteCompany('deleteCompanyModal')">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal  change Company Status  -->
<div class="modal fade" id="changeCompanyStatus" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Change Status</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <!-- <div class="modal-body">Are you sure you want to change  <b> {{activeCompany === '' ? '' : activeCompany.name}} </b> status ?</div> -->
      <div class="modal-body">Are you sure you want to change
        <b>{{activeCompany === undefined ? '' : activeCompany.name}}</b> status
        <b> {{activeCompany === undefined ? '' : activeCompany.isActive === true ? 'Active' : 'Inactive' }} </b> to
        <b> {{activeCompany === undefined ? '' : !activeCompany.isActive === true ? 'Active' : 'Inactive' }}</b> ?

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger"
          (click)="changeCompanyStatus('changeCompanyStatus')">Change</button>
      </div>
    </div>
  </div>
</div>